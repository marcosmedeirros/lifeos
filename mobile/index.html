<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="manifest" href="/manifest.json" />
    <title>LifeOS Mobile</title>
    <!-- React via CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root { --bg:#f6f7fb; --panel:#ffffff; --card:#ffffff; --muted:#697386; --accent:#6a7bff; --accent2:#5fd4ff; --text:#111827; --border:#e5e7f3; }
        *{box-sizing:border-box;} a{text-decoration:none;color:inherit;}
        body{margin:0;font-family:'Inter',system-ui,sans-serif;background:linear-gradient(180deg,#fdf2f7 0%,#f6f7fb 35%,#eef3ff 100%);min-height:100vh;color:var(--text);} 
        .page{min-height:100vh;padding:18px 16px 32px;max-width:520px;margin:0 auto;}
        .topbar{position:sticky;top:0;z-index:20;backdrop-filter:blur(10px);background:rgba(255,255,255,0.75);border:1px solid rgba(255,255,255,0.9);border-radius:18px;margin:-8px -4px 16px -4px;padding:14px 16px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 12px 40px rgba(17,24,39,0.08);} 
        .brand{font-weight:800;letter-spacing:0.2px;} .status{color:var(--muted);font-size:12px;}
        .nav{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:16px;} @media(min-width:640px){.nav{grid-template-columns:repeat(4,1fr);} }
        .nav button{border:1px solid var(--border);background:#f5f7ff;color:var(--muted);padding:12px 10px;border-radius:14px;font-weight:800;font-size:14px;cursor:pointer;box-shadow:0 10px 28px rgba(17,24,39,0.06);transition:all .18s ease;} 
        .nav button.active{color:#0f172a;border-color:rgba(90,120,255,0.4);background:linear-gradient(135deg,rgba(90,120,255,0.16),rgba(95,212,255,0.14));box-shadow:0 12px 30px rgba(90,120,255,0.18);} 
        .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:16px;box-shadow:0 16px 44px rgba(17,24,39,0.08);} .card + .card{margin-top:12px;}
        .input, select, button.action{width:100%;padding:12px;border-radius:14px;border:1px solid var(--border);background:#f9fbff;color:var(--text);font-size:14px;box-shadow:inset 0 1px 0 rgba(255,255,255,0.5);} 
        button.action{cursor:pointer;font-weight:800;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#0a0d1a;border:none;box-shadow:0 12px 28px rgba(90,120,255,0.22);} 
        .label{font-size:13px;color:var(--muted);} .list{display:grid;gap:10px;margin-top:10px;} 
        .item{border:1px solid var(--border);padding:12px;border-radius:14px;background:linear-gradient(180deg,#ffffff 0%,#f8faff 100%);box-shadow:0 10px 25px rgba(17,24,39,0.05);} 
        .title{font-weight:800;font-size:14px;margin-bottom:4px;color:#111827;} .meta{color:var(--muted);font-size:12px;display:flex;gap:8px;align-items:center;flex-wrap:wrap;} 
        .badge{display:inline-flex;align-items:center;gap:4px;font-size:11px;padding:4px 9px;border-radius:999px;background:rgba(106,123,255,0.14);color:var(--accent);border:1px solid rgba(106,123,255,0.24);} 
        .grid2{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;}
        .pill-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px;}
        .pill{padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:#f4f6fb;color:var(--muted);font-size:12px;font-weight:700;cursor:pointer;box-shadow:0 8px 18px rgba(17,24,39,0.04);transition:all .16s ease;}
        .pill.active{background:linear-gradient(135deg,rgba(90,120,255,0.18),rgba(95,212,255,0.14));color:#0f172a;border-color:rgba(90,120,255,0.32);} 
        .day-row{display:flex;gap:8px;overflow:auto;padding:4px 0;margin-top:8px;}
        .day-chip{min-width:54px;text-align:center;padding:8px 10px;border-radius:12px;border:1px solid var(--border);background:#fff;color:#111827;box-shadow:0 8px 20px rgba(17,24,39,0.05);}
        .day-chip.active{background:linear-gradient(135deg,rgba(90,120,255,0.18),rgba(95,212,255,0.14));border-color:rgba(90,120,255,0.32);} 
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const tabs = [
            { id:'dashboard', label:'Dashboard', icon:'üè†' },
            { id:'agenda', label:'Agenda', icon:'üìÖ' },
            { id:'activities', label:'Atividades', icon:'‚úÖ' },
            { id:'habits', label:'H√°bitos', icon:'üéØ' },
            { id:'finance', label:'Finan√ßas', icon:'üí∞' },
            { id:'board', label:'Board', icon:'üì∏' },
            { id:'routine', label:'Rotina', icon:'üìñ' },
            { id:'strava', label:'Strava', icon:'üö¥' }
        ];

        const api = async (url, options={}) => {
            try {
                const res = await fetch(url, { credentials:'same-origin', ...options });
                const text = await res.text();
                if (!res.ok) throw new Error(`${res.status} ${res.statusText} | ${text.slice(0,200)}`);
                try { return JSON.parse(text); } catch (e) { throw new Error('Resposta inv√°lida'); }
            } catch (err) { console.error(err); return { error: err.message }; }
        };

        const nowLocal = () => { const n = new Date(); return new Date(n.getTime() - n.getTimezoneOffset()*60000); };
        const fmtDateTime = dt => dt ? new Date(dt).toLocaleString('pt-BR') : '';
        const periodLabel = p => ({ morning:'Manh√£', afternoon:'Tarde', night:'Noite' }[p] || 'Dia');
        const periodIcon = p => ({ morning:'üåÖ', afternoon:'üå§Ô∏è', night:'üåô' }[p] || 'üóíÔ∏è');
        const eventEmoji = title => {
            const t=(title||'').toLowerCase();
            if(t.includes('reuni')||t.includes('call')||t.includes('meet')) return 'üìû';
            if(t.includes('treino')||t.includes('gym')||t.includes('run')||t.includes('corrida')) return 'üèÉ';
            if(t.includes('pagar')||t.includes('conta')||t.includes('bill')) return 'üí≥';
            if(t.includes('anivers')||t.includes('bday')) return 'üéâ';
            if(t.includes('medico')||t.includes('doctor')) return 'ü©∫';
            return 'üìå';
        };
        const habitColors = ['#e8f1ff','#ffeef5','#e8fff2','#fff5e5','#f1e8ff'];
        const fmtMoney = v => (Number(v)||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

        function App(){
            const [tab, setTab] = useState('dashboard');
            const [status, setStatus] = useState('Online');
            return (
                <div className="page">
                    <header className="topbar">
                        <div className="brand">LifeOS Mobile</div>
                        <div className="status">{status}</div>
                    </header>
                    <nav className="nav">
                        {tabs.map(t => (
                            <button key={t.id} className={tab===t.id?'active':''} onClick={()=>setTab(t.id)}>{t.icon} {t.label}</button>
                        ))}
                    </nav>
                    {tab==='dashboard' && <Dashboard setStatus={setStatus} />}
                    {tab==='agenda' && <Agenda setStatus={setStatus} />}
                    {tab==='activities' && <Activities setStatus={setStatus} />}
                    {tab==='habits' && <Habits setStatus={setStatus} />}
                    {tab==='finance' && <Finance setStatus={setStatus} />}
                    {tab==='board' && <Board setStatus={setStatus} />}
                    {tab==='routine' && <Routine setStatus={setStatus} />}
                    {tab==='strava' && <Strava setStatus={setStatus} />}
                </div>
            );
        }

        function Dashboard({ setStatus }){
            const [eventTitle,setEventTitle]=useState('');
            const [eventDt,setEventDt]=useState(nowLocal().toISOString().slice(0,16));
            const [actTitle,setActTitle]=useState('');
            const [actDate,setActDate]=useState(nowLocal().toISOString().slice(0,10));
            const [actPeriod,setActPeriod]=useState('morning');

            const createEvent=async()=>{
                if(!eventTitle||!eventDt) return;
                const res=await api('../modules/google_agenda.php?api=create_event',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({title:eventTitle,start_date:eventDt})});
                if(res&&!res.error){setStatus('Evento criado');setEventTitle('');} else setStatus(res?.error||'Erro');
            };
            const createActivity=async()=>{
                if(!actTitle||!actDate) return;
                const res=await api('../modules/activities.php?api=save_activity',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({title:actTitle,date:actDate,period:actPeriod})});
                if(res&&!res.error){setStatus('Atividade criada');setActTitle('');} else setStatus(res?.error||'Erro');
            };

            return (
                <div className="card">
                    <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',gap:10}}>
                        <h2 className="title" style={{fontSize:'16px',margin:0,display:'flex',alignItems:'center',gap:8}}>
                            <span>üöÄ</span><span>Atalhos r√°pidos</span>
                        </h2>
                        <span className="badge" style={{background:'rgba(95,212,255,0.15)',color:'#0f172a'}}>Hoje</span>
                    </div>
                    <div className="grid2" style={{marginTop:10}}>
                        <div className="space-y-2">
                            <div className="label">Evento r√°pido</div>
                            <input className="input" placeholder="T√≠tulo" value={eventTitle} onChange={e=>setEventTitle(e.target.value)} />
                            <input className="input" type="datetime-local" value={eventDt} onChange={e=>setEventDt(e.target.value)} />
                            <button className="action" onClick={createEvent}>Adicionar evento</button>
                        </div>
                        <div className="space-y-2">
                            <div className="label">Atividade r√°pida</div>
                            <input className="input" placeholder="Atividade" value={actTitle} onChange={e=>setActTitle(e.target.value)} />
                            <input className="input" type="date" value={actDate} onChange={e=>setActDate(e.target.value)} />
                            <select className="input" value={actPeriod} onChange={e=>setActPeriod(e.target.value)}>
                                <option value="morning">Manh√£</option><option value="afternoon">Tarde</option><option value="night">Noite</option>
                            </select>
                            <button className="action" onClick={createActivity}>Adicionar atividade</button>
                        </div>
                    </div>
                </div>
            );
        }

        function Agenda({ setStatus }){
            const [ym,setYm]=useState(nowLocal().toISOString().slice(0,7));
            const [events,setEvents]=useState([]);
            const [eventTitle,setEventTitle]=useState('');
            const [eventDt,setEventDt]=useState(nowLocal().toISOString().slice(0,16));
            const [scope,setScope]=useState('month');
            const [selectedDay,setSelectedDay]=useState(nowLocal().toISOString().slice(0,10));
            const filtered=useMemo(()=>{
                const list=events.filter(e=>(e.start_date||'').startsWith(ym));
                if(scope==='today'){
                    const today=nowLocal().toISOString().slice(0,10);
                    return list.filter(e=>(e.start_date||'').startsWith(today));
                }
                if(scope==='day'){
                    return list.filter(e=>(e.start_date||'').startsWith(selectedDay));
                }
                return list;
            },[events,ym,scope,selectedDay]);
            const sorted = useMemo(()=>filtered.slice().sort((a,b)=>new Date(a.start_date||0)-new Date(b.start_date||0)),[filtered]);
            useEffect(()=>{load();},[]);

            const load=async()=>{setStatus('Carregando...');const data=await api('../modules/google_agenda.php?api=list_events'); if(data&&!data.error){setEvents(data.events||[]);setStatus('Online');} else setStatus(data?.error||'Erro');};
            const sync=async()=>{setStatus('Sincronizando...');await api('../modules/google_agenda.php?api=sync_from_google');await load();};
            const createEvent=async()=>{if(!eventTitle||!eventDt)return;const res=await api('../modules/google_agenda.php?api=create_event',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({title:eventTitle,start_date:eventDt})}); if(res&&!res.error){setStatus('Evento criado');setEventTitle('');load();} else setStatus(res?.error||'Erro');};

            return (
                <div className="card">
                    <div className="flex" style={{display:'flex',flexDirection:'column',gap:8}}>
                        <div style={{display:'flex',flexWrap:'wrap',gap:8,justifyContent:'space-between',alignItems:'center'}}>
                            <div>
                                <div className="title" style={{fontSize:'16px'}}>Agenda</div>
                                <div className="label">Sincronizado com Google</div>
                            </div>
                            <div style={{display:'flex',gap:8,flexWrap:'wrap'}}>
                                <input className="input" style={{width:140}} type="month" value={ym} onChange={e=>setYm(e.target.value)} />
                                <button className="action" style={{width:'auto'}} onClick={sync}>Sincronizar</button>
                            </div>
                        </div>
                        <div className="pill-row">
                            {['month','today'].map(p=>(
                                <div key={p} className={`pill ${scope===p?'active':''}`} onClick={()=>setScope(p)}>
                                    {p==='month'?'Este m√™s':'Hoje'}
                                </div>
                            ))}
                        </div>
                        <div className="day-row">
                            {[...Array(7).keys()].map(i=>{const d=new Date();d.setDate(d.getDate()+i);const ds=d.toISOString().slice(0,10);return (
                                <div key={i} className={`day-chip ${ds===selectedDay?'active':''}`} onClick={()=>{setSelectedDay(ds);setScope('day');}}>
                                    <div style={{fontSize:12,color:'#6b7280'}}>{d.toLocaleDateString('pt-BR',{weekday:'short'})}</div>
                                    <div style={{fontWeight:800}}>{d.getDate()}</div>
                                </div>
                            );})}
                        </div>
                        <div className="grid2">
                            <div className="space-y-2">
                                <div className="label">Novo evento</div>
                                <input className="input" placeholder="T√≠tulo" value={eventTitle} onChange={e=>setEventTitle(e.target.value)} />
                                <input className="input" type="datetime-local" value={eventDt} onChange={e=>setEventDt(e.target.value)} />
                                <button className="action" onClick={createEvent}>Adicionar</button>
                            </div>
                        </div>
                        <div className="list" style={{maxHeight:'60vh',overflow:'auto',paddingRight:4}}>
                            {!sorted.length && <div className="item">Sem eventos.</div>}
                            {sorted.map(ev=>{const dt=ev.start_date?.replace(' ','T'); const dateObj = dt? new Date(dt):null; const day = dateObj? dateObj.toLocaleDateString('pt-BR',{day:'2-digit',month:'short'}) : ''; const hour = dateObj? dateObj.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'}) : '';
                                return (
                                <div key={ev.id||ev.google_event_id} className="item" style={{display:'flex',gap:12,alignItems:'center',background:'#ffffff',borderColor:'#e5e7f3',boxShadow:'0 16px 34px rgba(17,24,39,0.08)'}}>
                                    <div style={{minWidth:58,textAlign:'center'}}>
                                        <div className="badge" style={{display:'flex',flexDirection:'column',gap:2,alignItems:'center',padding:'6px 8px',width:'100%',background:'rgba(90,120,255,0.12)'}}>
                                            <span style={{fontSize:11,letterSpacing:0.5}}>Dia</span>
                                            <span style={{fontWeight:800,fontSize:14,color:'#0f172a'}}>{day}</span>
                                        </div>
                                    </div>
                                    <div style={{flex:1}}>
                                        <div className="title" style={{display:'flex',alignItems:'center',gap:8,marginBottom:4}}>
                                            <span>{eventEmoji(ev.title)}</span>
                                            <span>{ev.title||'Sem t√≠tulo'}</span>
                                        </div>
                                        <div className="meta" style={{gap:6}}>
                                            <span className="badge" style={{background:'rgba(99,197,255,0.18)',color:'var(--accent2)',borderColor:'rgba(99,197,255,0.32)'}}>{hour||'Hor√°rio'}</span>
                                            <span>{fmtDateTime(dt)}</span>
                                        </div>
                                    </div>
                                </div>
                            );})}
                        </div>
                    </div>
                </div>
            );
        }

        function Activities({ setStatus }){
            const [date,setDate]=useState(nowLocal().toISOString().slice(0,10));
            const [items,setItems]=useState([]);
            const [title,setTitle]=useState('');
            const [period,setPeriod]=useState('morning');
            const [editingId,setEditingId]=useState(null);
            useEffect(()=>{load();},[date]);
            const load=async()=>{setStatus('Carregando...');const data=await api(`../modules/activities.php?api=get_activities&start=${date}&end=${date}`); if(data&&!data.error){setItems(data||[]);setStatus('Online');} else setStatus(data?.error||'Erro');};
            const save=async()=>{if(!title||!date)return;const payload={title,date,period}; if(editingId) payload.id=editingId; const res=await api('../modules/activities.php?api=save_activity',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}); if(res&&!res.error){setStatus(editingId?'Atividade atualizada':'Atividade criada');setTitle('');setEditingId(null);load();} else setStatus(res?.error||'Erro');};
            const toggle=async(id)=>{setStatus('Atualizando...');await api('../modules/activities.php?api=toggle_activity',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id})});await load();};
            const remove=async(id)=>{setStatus('Removendo...');await api('../modules/activities.php?api=delete_activity',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id})});await load();};
            const startEdit=(a)=>{setTitle(a.title||'');setPeriod(a.period||'morning');setDate(a.day_date||date);setEditingId(a.id);setStatus('Editando atividade');};

            return (
                <div className="card">
                    <div style={{display:'flex',flexDirection:'column',gap:8}}>
                        <div style={{display:'flex',flexWrap:'wrap',gap:8,justifyContent:'space-between',alignItems:'center'}}>
                            <div>
                                <div className="title" style={{fontSize:'16px'}}>Atividades</div>
                                <div className="label">Planejamento do dia</div>
                            </div>
                            <div style={{display:'flex',gap:8,alignItems:'center'}}>
                                <input className="input" style={{width:160}} type="date" value={date} onChange={e=>setDate(e.target.value)} />
                                <button className="pill" style={{border:'1px solid var(--border)',background:'#fff'}} onClick={()=>setDate(nowLocal().toISOString().slice(0,10))}>Hoje</button>
                            </div>
                        </div>
                        <div className="grid2">
                            <div className="space-y-2">
                                <div className="label">Nova atividade</div>
                                <input className="input" placeholder="T√≠tulo" value={title} onChange={e=>setTitle(e.target.value)} />
                                <select className="input" value={period} onChange={e=>setPeriod(e.target.value)}>
                                    <option value="morning">Manh√£</option><option value="afternoon">Tarde</option><option value="night">Noite</option>
                                </select>
                                <button className="action" onClick={save}>{editingId?'Salvar edi√ß√£o':'Adicionar'}</button>
                            </div>
                        </div>
                        <div className="list" style={{maxHeight:'60vh',overflow:'auto',paddingRight:4}}>
                            {!items.length && <div className="item">Sem atividades.</div>}
                            {items.map(a=>(
                                <div key={a.id} className="item" style={{display:'flex',justifyContent:'space-between',alignItems:'center',gap:10,background:'#fff',boxShadow:'0 12px 28px rgba(17,24,39,0.07)'}}>
                                    <div style={{display:'flex',gap:10,alignItems:'center'}}>
                                        <span style={{fontSize:18}}>{periodIcon(a.period)}</span>
                                        <div>
                                            <div className="title" style={{marginBottom:2}}>{a.title}</div>
                                            <div className="meta"><span>{a.day_date}</span><span className="badge">{periodLabel(a.period)}</span></div>
                                        </div>
                                    </div>
                                    <div style={{display:'flex',alignItems:'center',gap:8}}>
                                        <button onClick={()=>toggle(a.id)} style={{border:'none',background:'transparent',fontSize:18,cursor:'pointer'}} aria-label="Marcar feito">
                                            {Number(a.status)===1?'‚òëÔ∏è':'‚¨ú'}
                                        </button>
                                        <button onClick={()=>startEdit(a)} style={{border:'none',background:'transparent',fontSize:15,cursor:'pointer',color:'#64748b'}} aria-label="Editar">‚úèÔ∏è</button>
                                        <button onClick={()=>remove(a.id)} style={{border:'none',background:'transparent',fontSize:15,cursor:'pointer',color:'#ef4444'}} aria-label="Excluir">üóëÔ∏è</button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        function Habits({ setStatus }){
            const [ym,setYm]=useState(nowLocal().toISOString().slice(0,7));
            const [items,setItems]=useState([]);
            const [selectedDay,setSelectedDay]=useState(nowLocal().toISOString().slice(0,10));
            const [viewMode,setViewMode]=useState('all');
            const today = nowLocal().toISOString().slice(0,10);
            useEffect(()=>{load();},[ym]);
            const load=async()=>{setStatus('Carregando...');const data=await api(`../modules/habits.php?api=get_habits&month=${ym}`); if(data&&!data.error){setItems(data||[]);setStatus('Online');} else setStatus(data?.error||'Erro');};
            const toggle=async(id)=>{setStatus('Atualizando...'); await api('../modules/habits.php?api=toggle_habit',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id,date:selectedDay})}); await load();};
            return (
                <div className="card">
                    <div style={{display:'flex',flexDirection:'column',gap:8}}>
                        <div style={{display:'flex',flexWrap:'wrap',gap:8,justifyContent:'space-between',alignItems:'center'}}>
                            <div>
                                <div className="title" style={{fontSize:'16px'}}>H√°bitos</div>
                                <div className="label">Resumo mensal</div>
                            </div>
                            <input className="input" style={{width:160}} type="month" value={ym} onChange={e=>setYm(e.target.value)} />
                        </div>
                        <div className="pill-row">
                            {['all','done'].map(mode=>(
                                <div key={mode} className={`pill ${viewMode===mode?'active':''}`} onClick={()=>setViewMode(mode)}>
                                    {mode==='all'?'Todos':'Feitos no dia'}
                                </div>
                            ))}
                        </div>
                        <div className="day-row">
                            {[...Array(7).keys()].map(i=>{const d=new Date();d.setDate(d.getDate()+i);const ds=d.toISOString().slice(0,10);return (
                                <div key={i} className={`day-chip ${ds===selectedDay?'active':''}`} onClick={()=>setSelectedDay(ds)}>
                                    <div style={{fontSize:12,color:'#6b7280'}}>{d.toLocaleDateString('pt-BR',{weekday:'short'})}</div>
                                    <div style={{fontWeight:800}}>{d.getDate()}</div>
                                </div>
                            );})}
                        </div>
                        <div className="grid2">
                            {!items.length && <div className="item">Sem h√°bitos.</div>}
                            {items
                                .filter(h=>{
                                    const parsed = h.checked_dates?JSON.parse(h.checked_dates):[];
                                    const doneSelected = parsed.includes(selectedDay);
                                    if(viewMode==='done') return doneSelected;
                                    return true;
                                })
                                .map((h,idx)=>{const parsed = h.checked_dates?JSON.parse(h.checked_dates):[]; const doneSelected = parsed.includes(selectedDay); const checks=parsed.length; const color=habitColors[idx%habitColors.length]; return (
                                <div key={h.id} className="item" style={{display:'flex',flexDirection:'column',gap:10,background:color,borderColor:'rgba(0,0,0,0.04)',boxShadow:'0 16px 34px rgba(17,24,39,0.08)'}}>
                                    <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                                        <div className="title" style={{display:'flex',alignItems:'center',gap:8}}>
                                            <span>üî•</span>
                                            <span>{h.name}</span>
                                        </div>
                                        <span className="badge" style={{background:'rgba(255,149,5,0.18)',color:'#b45309',borderColor:'rgba(255,149,5,0.3)'}}>{checks} dias</span>
                                    </div>
                                    <div className="meta" style={{justifyContent:'space-between',width:'100%'}}>
                                        <span>Status: {doneSelected?'Feito no dia':'Pendente'}</span>
                                        <span className="badge" style={{background: doneSelected?'rgba(76,175,80,0.2)':'rgba(99,197,255,0.18)',color: doneSelected?'#0f5132':'#0f172a',borderColor: doneSelected?'rgba(76,175,80,0.35)':'rgba(99,197,255,0.3)'}}>{doneSelected?'‚úîÔ∏è':'Marcar'}</span>
                                    </div>
                                    <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',gap:10}}>
                                        <button className="action" onClick={()=>toggle(h.id)} style={{background:doneSelected?'linear-gradient(135deg,#5fe37c,#4ccf9a)':undefined,flex:1}}>Marcar dia</button>
                                        <span style={{fontSize:20}}>üèÖ</span>
                                    </div>
                                </div>
                            );})}
                        </div>
                    </div>
                </div>
            );
        }

        function Finance({ setStatus }){
            const [ym,setYm]=useState(nowLocal().toISOString().slice(0,7));
            const [list,setList]=useState([]);
            const [cats,setCats]=useState([]);
            const [summary,setSummary]=useState({income:0,outcome:0,balance:0,total_balance:0});
            const [form,setForm]=useState({id:null,type:'expense',amount:'',desc:'',category_id:'',date:nowLocal().toISOString().slice(0,16)});

            useEffect(()=>{load();},[ym]);

            const load=async()=>{
                setStatus('Carregando...');
                const [catData,finData] = await Promise.all([
                    api(`../modules/finance.php?api=get_finance_categories`),
                    api(`../modules/finance.php?api=get_finances&month=${ym}`)
                ]);
                if(catData&&!catData.error) setCats(catData||[]);
                if(finData&&!finData.error){setList(finData.list||[]);setSummary(finData.summary||{});setStatus('Online');}
                else setStatus(finData?.error||'Erro');
            };

            const save=async()=>{
                if(!form.amount||!form.desc||!form.date) return;
                await api('../modules/finance.php?api=save_finance',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(form)});
                setForm({id:null,type:'expense',amount:'',desc:'',category_id:'',date:nowLocal().toISOString().slice(0,16)});
                load();
            };

            const edit=(it)=>{setForm({id:it.id,type:it.type,amount:it.amount,desc:it.description,category_id:it.category_id||'',date:(it.created_at||'').replace(' ','T')});};
            const remove=async(id)=>{await api('../modules/finance.php?api=delete_finance',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id})});load();};
            const toggle=async(id)=>{await api('../modules/finance.php?api=toggle_finance',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id})});load();};

            return (
                <div className="card">
                    <div style={{display:'flex',flexDirection:'column',gap:12}}>
                        <div style={{display:'flex',flexWrap:'wrap',gap:8,justifyContent:'space-between',alignItems:'center'}}>
                            <div>
                                <div className="title" style={{fontSize:'16px'}}>Finan√ßas</div>
                                <div className="label">Resumo mensal</div>
                            </div>
                            <input className="input" style={{width:150}} type="month" value={ym} onChange={e=>setYm(e.target.value)} />
                        </div>
                        <div className="grid2">
                            <div className="item" style={{display:'flex',justifyContent:'space-between'}}>
                                <div className="label">Entradas</div>
                                <div className="title" style={{color:'#16a34a'}}>{fmtMoney(summary.income||0)}</div>
                            </div>
                            <div className="item" style={{display:'flex',justifyContent:'space-between'}}>
                                <div className="label">Sa√≠das</div>
                                <div className="title" style={{color:'#dc2626'}}>{fmtMoney(summary.outcome||0)}</div>
                            </div>
                            <div className="item" style={{display:'flex',justifyContent:'space-between'}}>
                                <div className="label">Balan√ßo m√™s</div>
                                <div className="title">{fmtMoney(summary.balance||0)}</div>
                            </div>
                            <div className="item" style={{display:'flex',justifyContent:'space-between'}}>
                                <div className="label">Saldo geral</div>
                                <div className="title">{fmtMoney(summary.total_balance||0)}</div>
                            </div>
                        </div>
                        <div className="grid2">
                            <div className="space-y-2">
                                <div className="label">Lan√ßamento r√°pido</div>
                                <select className="input" value={form.type} onChange={e=>setForm({...form,type:e.target.value})}>
                                    <option value="expense">Sa√≠da</option><option value="income">Entrada</option>
                                </select>
                                <input className="input" type="number" step="0.01" placeholder="Valor" value={form.amount} onChange={e=>setForm({...form,amount:e.target.value})} />
                                <input className="input" placeholder="Descri√ß√£o" value={form.desc} onChange={e=>setForm({...form,desc:e.target.value})} />
                                <select className="input" value={form.category_id} onChange={e=>setForm({...form,category_id:e.target.value})}>
                                    <option value="">Sem categoria</option>
                                    {cats.map(c=>(<option key={c.id} value={c.id}>{c.name}</option>))}
                                </select>
                                <input className="input" type="datetime-local" value={form.date} onChange={e=>setForm({...form,date:e.target.value})} />
                                <button className="action" onClick={save}>{form.id?'Salvar edi√ß√£o':'Adicionar'}</button>
                            </div>
                        </div>
                        <div className="list" style={{maxHeight:'55vh',overflow:'auto',paddingRight:4}}>
                            {!list.length && <div className="item">Sem lan√ßamentos.</div>}
                            {list.map(it=>(
                                <div key={it.id} className="item" style={{display:'flex',justifyContent:'space-between',alignItems:'center',gap:10}}>
                                    <div style={{display:'flex',gap:10,alignItems:'center'}}>
                                        <span>{it.type==='income'?'‚¨ÜÔ∏è':'‚¨áÔ∏è'}</span>
                                        <div>
                                            <div className="title" style={{marginBottom:2}}>{it.description||'Sem descri√ß√£o'}</div>
                                            <div className="meta" style={{gap:6}}>
                                                <span>{new Date(it.created_at.replace(' ','T')).toLocaleString('pt-BR')}</span>
                                                {it.cat_name && <span className="badge">{it.cat_name}</span>}
                                            </div>
                                        </div>
                                    </div>
                                    <div style={{display:'flex',flexDirection:'column',alignItems:'flex-end',gap:6}}>
                                        <div className="title" style={{color:it.type==='income'?'#16a34a':'#dc2626'}}>{fmtMoney(it.amount)}</div>
                                        <div style={{display:'flex',gap:8}}>
                                            <button onClick={()=>toggle(it.id)} style={{border:'none',background:'transparent',cursor:'pointer',color:'#0f172a'}}>{Number(it.status)===1?'‚úîÔ∏è':'‚è≥'}</button>
                                            <button onClick={()=>edit(it)} style={{border:'none',background:'transparent',cursor:'pointer',color:'#64748b'}}>‚úèÔ∏è</button>
                                            <button onClick={()=>remove(it.id)} style={{border:'none',background:'transparent',cursor:'pointer',color:'#ef4444'}}>üóëÔ∏è</button>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        function Board({ setStatus }){
            const [photos,setPhotos]=useState([]);
            const [date,setDate]=useState(nowLocal().toISOString().slice(0,10));
            const [file,setFile]=useState(null);

            useEffect(()=>{load();},[]);
            const load=async()=>{setStatus('Carregando...');const data=await api('../modules/board.php?api=get_photos'); if(data&&!data.error){setPhotos(data||[]);setStatus('Online');} else setStatus(data?.error||'Erro');};

            const upload=async()=>{
                if(!file) return;
                const fd=new FormData(); fd.append('photo',file); fd.append('photo_date',date);
                await fetch('../modules/board.php?api=upload_photo',{method:'POST',body:fd,credentials:'same-origin'});
                setFile(null); load(); setStatus('Foto enviada');
            };
            const remove=async(id)=>{await api('../modules/board.php?api=delete_photo',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id})});load();};

            return (
                <div className="card">
                    <div style={{display:'flex',flexDirection:'column',gap:10}}>
                        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',flexWrap:'wrap',gap:8}}>
                            <div className="title" style={{fontSize:'16px'}}>Board di√°rio</div>
                            <input className="input" style={{width:150}} type="date" value={date} onChange={e=>setDate(e.target.value)} />
                        </div>
                        <div className="grid2">
                            <div className="space-y-2">
                                <div className="label">Foto do dia</div>
                                <input className="input" type="file" accept="image/*" onChange={e=>setFile(e.target.files[0])} />
                                <button className="action" onClick={upload}>Enviar</button>
                            </div>
                        </div>
                        <div className="grid2">
                            {!photos.length && <div className="item">Sem fotos.</div>}
                            {photos.map(p=>(
                                <div key={p.id} className="item" style={{padding:10}}>
                                    <div style={{position:'relative'}}>
                                        <img src={p.image_path} alt="foto" style={{width:'100%',borderRadius:12,objectFit:'cover'}} />
                                        <button onClick={()=>remove(p.id)} style={{position:'absolute',top:6,right:6,border:'none',background:'rgba(0,0,0,0.5)',color:'#fff',borderRadius:'50%',width:32,height:32,cursor:'pointer'}}>üóëÔ∏è</button>
                                    </div>
                                    <div className="meta" style={{marginTop:6}}>{new Date(p.photo_date+'T00:00:00').toLocaleDateString('pt-BR')}</div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        function Routine({ setStatus }){
            const [ym,setYm]=useState(nowLocal().toISOString().slice(0,7));
            const [selectedDay,setSelectedDay]=useState(nowLocal().toISOString().slice(0,10));
            const [mood,setMood]=useState('üòä');
            const [content,setContent]=useState('');
            const [days,setDays]=useState([]);

            useEffect(()=>{loadMonth();},[ym]);
            useEffect(()=>{loadDay(selectedDay);},[selectedDay]);

            const loadMonth=async()=>{setStatus('Carregando...');const data=await api(`../modules/routine.php?api=get_routine_month&month=${ym}`); if(data&&!data.error){setDays(data||[]);setStatus('Online');} else setStatus(data?.error||'Erro');};
            const loadDay=async(d)=>{const log=await api(`../modules/routine.php?api=get_routine_day&date=${d}`); if(log&&!log.error&&log.log_date){setMood(log.mood||'üòä');setContent(log.content||'');} else {setMood('üòä');setContent('');}}
            const save=async()=>{await api('../modules/routine.php?api=save_routine',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({date:selectedDay,mood,content})});setStatus('Dia salvo');loadMonth();};

            const dayMood=(d)=>{const found=days.find(x=>x.log_date===d);return found?found.mood||'üìù':'+';};

            return (
                <div className="card">
                    <div style={{display:'flex',flexDirection:'column',gap:10}}>
                        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',flexWrap:'wrap',gap:8}}>
                            <div className="title" style={{fontSize:'16px'}}>Rotina</div>
                            <input className="input" style={{width:150}} type="month" value={ym} onChange={e=>setYm(e.target.value)} />
                        </div>
                        <div className="day-row">
                            {[...Array(7).keys()].map(i=>{const d=new Date();d.setDate(d.getDate()+i);const ds=d.toISOString().slice(0,10);return (
                                <div key={i} className={`day-chip ${ds===selectedDay?'active':''}`} onClick={()=>setSelectedDay(ds)}>
                                    <div style={{fontSize:12,color:'#6b7280'}}>{d.toLocaleDateString('pt-BR',{weekday:'short'})}</div>
                                    <div style={{fontWeight:800}}>{d.getDate()}</div>
                                    <div style={{fontSize:16}}>{dayMood(ds)}</div>
                                </div>
                            );})}
                        </div>
                        <div className="item" style={{display:'flex',gap:8,alignItems:'center',justifyContent:'space-between'}}>
                            <div className="label">Humor</div>
                            <div style={{display:'flex',gap:8}}>
                                {['ü§©','üòä','üòê','üòü','üò≠'].map(m=>(
                                    <button key={m} onClick={()=>setMood(m)} style={{border:'none',background:'transparent',fontSize:22,opacity:mood===m?1:0.4,cursor:'pointer'}}>{m}</button>
                                ))}
                            </div>
                        </div>
                        <textarea className="input" style={{height:140}} placeholder="Como foi seu dia?" value={content} onChange={e=>setContent(e.target.value)}></textarea>
                        <button className="action" onClick={save}>Salvar dia</button>
                    </div>
                </div>
            );
        }

        function Strava({ setStatus }){
            const [data,setData]=useState(null);

            useEffect(()=>{load();},[]);
            const load=async()=>{setStatus('Carregando...');const res=await api('../modules/strava.php?api=get_strava_data'); if(res&&!res.error){setData(res);setStatus('Online');} else setStatus(res?.error||'Erro');};
            const toggle=async(id)=>{await api('../modules/strava.php?api=toggle_strava_done',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:new URLSearchParams({strava_id:id}).toString()});load();};

            if(!data) return <div className="card">Carregando...</div>;
            if(!data.connected) return (
                <div className="card" style={{textAlign:'center'}}>
                    <div className="title" style={{fontSize:'16px'}}>Conectar Strava</div>
                    <a className="action" href={data.auth_url} style={{display:'inline-block',marginTop:12}}>Autorizar</a>
                </div>
            );

            return (
                <div className="card">
                    <div style={{display:'flex',flexDirection:'column',gap:10}}>
                        <div className="title" style={{fontSize:'16px'}}>Treinos Strava</div>
                        <div className="grid2">
                            <div className="item" style={{display:'flex',justifyContent:'space-between'}}>
                                <span className="label">Km recentes</span><span className="title">{data.summary.total_km} km</span>
                            </div>
                            <div className="item" style={{display:'flex',justifyContent:'space-between'}}>
                                <span className="label">Tempo</span><span className="title">{data.summary.total_time}</span>
                            </div>
                            <div className="item" style={{display:'flex',justifyContent:'space-between'}}>
                                <span className="label">Atividades</span><span className="title">{data.summary.total_activities}</span>
                            </div>
                        </div>
                        <div className="list" style={{maxHeight:'55vh',overflow:'auto',paddingRight:4}}>
                            {!data.list?.length && <div className="item">Sem atividades.</div>}
                            {data.list?.map(act=>(
                                <div key={act.strava_id} className="item" style={{display:'flex',justifyContent:'space-between',alignItems:'center',gap:10}}>
                                    <div>
                                        <div className="title" style={{marginBottom:4}}>{act.name}</div>
                                        <div className="meta" style={{gap:6}}>
                                            <span className="badge">{act.type}</span>
                                            <span>{act.date}</span>
                                            <span>{act.distance} km</span>
                                            <span>{act.time}</span>
                                        </div>
                                    </div>
                                    <button onClick={()=>toggle(act.strava_id)} style={{border:'none',background:'transparent',fontSize:18,cursor:'pointer'}} aria-label="Marcar feito">{act.done?'‚úîÔ∏è':'‚¨ú'}</button>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
