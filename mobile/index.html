<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="manifest" href="/mobile/manifest.json" />
    <link rel="canonical" href="/mobile/index.html" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>LifeOS Mobile</title>
    <!-- React via CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root { --bg:#050505; --panel:#0b0b0b; --card:#0f0f0f; --muted:#b0b0b0; --accent:#ffffff; --accent2:#d9d9d9; --text:#f5f5f5; --border:#262626; }
        *{box-sizing:border-box;} a{text-decoration:none;color:inherit;}
        body{margin:0;font-family:'Inter',system-ui,sans-serif;background:linear-gradient(150deg,#030303 0%,#0a0a0a 55%,#111111 100%);min-height:100vh;color:var(--text);} 
        .page{min-height:100vh;padding:18px 16px 32px;max-width:520px;margin:0 auto;}
        .topbar{position:sticky;top:0;z-index:20;backdrop-filter:blur(10px);background:rgba(0,0,0,0.78);border:1px solid var(--border);border-radius:18px;margin:-8px -4px 16px -4px;padding:14px 16px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 12px 40px rgba(0,0,0,0.35);} 
        .brand{font-weight:800;letter-spacing:0.2px;} .status{color:var(--muted);font-size:12px;}
        .nav{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:16px;} @media(min-width:640px){.nav{grid-template-columns:repeat(4,1fr);} }
        .nav button{border:1px solid var(--border);background:#0c0c0c;color:var(--muted);padding:12px 10px;border-radius:14px;font-weight:800;font-size:14px;cursor:pointer;box-shadow:0 10px 28px rgba(0,0,0,0.35);transition:all .18s ease;} 
        .nav button.active{color:#000;border-color:#f5f5f5;background:linear-gradient(135deg,#f5f5f5,#d9d9d9);box-shadow:0 12px 30px rgba(0,0,0,0.35);} 
        .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:16px;box-shadow:0 16px 44px rgba(0,0,0,0.45);} .card + .card{margin-top:12px;}
        .input, select, button.action{width:100%;padding:12px;border-radius:14px;border:1px solid var(--border);background:#0d0d0d;color:var(--text);font-size:14px;box-shadow:inset 0 1px 0 rgba(255,255,255,0.04);} 
        button.action{cursor:pointer;font-weight:800;background:linear-gradient(135deg,#ffffff,#dcdcdc);color:#000;border:none;box-shadow:0 12px 28px rgba(0,0,0,0.35);} 
        .label{font-size:13px;color:var(--muted);} .list{display:grid;gap:10px;margin-top:10px;} 
        .item{border:1px solid var(--border);padding:12px;border-radius:14px;background:linear-gradient(180deg,rgba(12,12,12,0.98) 0%,rgba(16,16,16,0.94) 100%);box-shadow:0 10px 25px rgba(0,0,0,0.35);} 
        .title{font-weight:800;font-size:14px;margin-bottom:4px;color:#f5f5f5;} .meta{color:var(--muted);font-size:12px;display:flex;gap:8px;align-items:center;flex-wrap:wrap;} 
        .badge{display:inline-flex;align-items:center;gap:4px;font-size:11px;padding:4px 9px;border-radius:999px;background:rgba(255,255,255,0.12);color:var(--accent);border:1px solid rgba(255,255,255,0.24);} 
        .grid2{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;}
        .pill-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px;}
        .pill{padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:#0f0f0f;color:var(--muted);font-size:12px;font-weight:700;cursor:pointer;box-shadow:0 8px 18px rgba(0,0,0,0.28);transition:all .16s ease;}
        .pill.active{background:linear-gradient(135deg,rgba(255,255,255,0.16),rgba(220,220,220,0.18));color:#f5f5f5;border-color:rgba(255,255,255,0.5);} 
        .day-row{display:flex;gap:8px;overflow:auto;padding:4px 0;margin-top:8px;}
        .day-chip{min-width:54px;text-align:center;padding:8px 10px;border-radius:12px;border:1px solid var(--border);background:#0f0f0f;color:#f5f5f5;box-shadow:0 8px 20px rgba(0,0,0,0.3);}
        .day-chip.active{background:linear-gradient(135deg,rgba(255,255,255,0.16),rgba(220,220,220,0.18));border-color:rgba(255,255,255,0.5);} 
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const api = async (url, options={}) => {
            try {
                const res = await fetch(url, { credentials:'same-origin', ...options });
                const text = await res.text();
                if (res.status === 403 || text.includes('Sem Acesso')) {
                    const back = encodeURIComponent(window.location.pathname + window.location.search + window.location.hash);
                    window.location.href = '/login.php?redirect=' + back;
                    return { error:'Auth required' };
                }
                if (!res.ok) throw new Error(`${res.status} ${res.statusText} | ${text.slice(0,200)}`);
                try { return JSON.parse(text); } catch (e) { throw new Error('Resposta inv√°lida'); }
            } catch (err) { console.error(err); return { error: err.message }; }
        };

        const nowLocal = () => { const n = new Date(); return new Date(n.getTime() - n.getTimezoneOffset()*60000); };
        const fmtDateTime = dt => dt ? new Date(dt).toLocaleString('pt-BR') : '';
        const periodLabel = p => ({ morning:'Manh√£', afternoon:'Tarde', night:'Noite' }[p] || 'Dia');
        const periodIcon = p => ({ morning:'üåÖ', afternoon:'üå§Ô∏è', night:'üåô' }[p] || 'üóíÔ∏è');
        const eventEmoji = title => {
            const t=(title||'').toLowerCase();
            if(t.includes('reuni')||t.includes('call')||t.includes('meet')) return 'üìû';
            if(t.includes('treino')||t.includes('gym')||t.includes('run')||t.includes('corrida')) return 'üèÉ';
            if(t.includes('pagar')||t.includes('conta')||t.includes('bill')) return 'üí≥';
            if(t.includes('anivers')||t.includes('bday')) return 'üéâ';
            if(t.includes('medico')||t.includes('doctor')) return 'ü©∫';
            return 'üìå';
        };
        const habitColors = ['rgba(139,155,255,0.18)','rgba(93,211,255,0.16)','rgba(255,190,92,0.16)','rgba(255,132,196,0.16)','rgba(120,255,214,0.16)'];
        const fmtMoney = v => (Number(v)||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

        function App(){
            const [status, setStatus] = useState('Online');
            return (
                <div className="page">
                    <header className="topbar">
                        <div className="brand">LifeOS Mobile</div>
                        <div className="status">{status}</div>
                    </header>
                    <UnifiedApp setStatus={setStatus} />
                </div>
            );
        }

        function UnifiedApp({ setStatus }){
            const today=nowLocal().toISOString().slice(0,10);
            const [loading,setLoading]=useState(false);
            
            // Summary state
            const [summary,setSummary]=useState({
                today:{events:0,activities:0,doneActivities:0,habitsDone:0},
                week:{events:0,activities:0},
                finance:{income:0,outcome:0,balance:0,total_balance:0},
                routine:{mood:'üìù',content:'Sem anota√ß√£o'},
                strava:{trainedToday:false,time:'0h',activities:0}
            });
            
            // Events state
            const [todayEvents,setTodayEvents]=useState([]);
            
            // Activities state
            const [todayActivities,setTodayActivities]=useState([]);
            const [actTitle,setActTitle]=useState('');
            const [actPeriod,setActPeriod]=useState('morning');
            
            // Habits state
            const [habits,setHabits]=useState([]);
            
            // Finance state
            const [finType,setFinType]=useState('expense');
            const [finAmount,setFinAmount]=useState('');
            const [finDesc,setFinDesc]=useState('');
            const [weekFinance,setWeekFinance]=useState({income:0,outcome:0,monthOutcome:0});
            
            // Board state
            const [boardFile,setBoardFile]=useState(null);
            const [boardPhoto,setBoardPhoto]=useState(null);
            
            // Routine state
            const [routineMood,setRoutineMood]=useState('üòä');
            const [routineContent,setRoutineContent]=useState('');
            
            // Mensagem do dia
            const [dailyMessage,setDailyMessage]=useState('Carregando mensagem do dia...');

            const getWeekRange=()=>{
                const d=nowLocal();
                const dow=d.getDay()===0?6:d.getDay()-1;
                const start=new Date(d); start.setDate(d.getDate()-dow);
                const end=new Date(start); end.setDate(start.getDate()+6);
                const toStr=x=>x.toISOString().slice(0,10);
                return {start:toStr(start),end:toStr(end)};
            };

            useEffect(()=>{loadAll();},[]);

            const loadAll=async()=>{
                setLoading(true); setStatus('Carregando...');
                try {
                    const {start,end}=getWeekRange();
                    
                    // Carrega mensagem do dia
                    const now = new Date();
                    const startOfYear = new Date(now.getFullYear(), 0, 0);
                    const diff = now - startOfYear;
                    const oneDay = 1000 * 60 * 60 * 24;
                    const dayOfYear = Math.floor(diff / oneDay);
                    
                    const [eventsData,actsData,habitsData,finData,routineData,stravaData,messagesData,boardData,dashStats] = await Promise.all([
                        api('../modules/google_agenda.php?api=list_events'),
                        api(`../modules/activities.php?api=get_activities&start=${today}&end=${today}`),
                        api(`../modules/habits.php?api=get_habits&month=${today.slice(0,7)}`),
                        api(`../modules/finance.php?api=get_finances&month=${today.slice(0,7)}`),
                        api(`../modules/routine.php?api=get_routine_day&date=${today}`),
                        api('../modules/strava.php?api=get_strava_data'),
                        fetch('../mensagens_365.json').then(r=>r.json()).catch(()=>[]),
                        api('../modules/board.php?api=get_photos'),
                        api('../index.php?api=dashboard_stats')
                    ]);
                    
                    // Busca mensagem do dia
                    const todayMessage = Array.isArray(messagesData) ? messagesData.find(m=>m.dia===dayOfYear) : null;
                    setDailyMessage(todayMessage?.mensagem || 'A persist√™ncia √© o caminho do √™xito.');

                    // Events
                    const evs = eventsData?.events||[];
                    const todayEvs = evs.filter(ev=>(ev.start_date||'').startsWith(today));
                    setTodayEvents(todayEvs.slice(0,3)); // Apenas 3 primeiros

                    // Activities
                    const actsRaw = Array.isArray(actsData)?actsData:[];
                    setTodayActivities(actsRaw);
                    const doneToday = actsRaw.filter(a=>Number(a.status)===1).length;

                    // Habits
                    const habitList = Array.isArray(habitsData)?habitsData:[];
                    setHabits(habitList);
                    const habitsDone = habitList.filter(h=>{
                        try { return (h.checked_dates?JSON.parse(h.checked_dates):[]).includes(today); } catch(e){ return false; }
                    }).length;

                    // Finance - usar os dados do dashboard_stats que j√° calcula corretamente
                    const finSummary = finData?.summary||{income:0,outcome:0,balance:0,total_balance:0};
                    const weekIncomeFromStats = dashStats?.income_week || 0;
                    const weekOutcomeFromStats = dashStats?.outcome_week || 0;
                    console.log('Gastos da semana (do dashboard_stats):', weekOutcomeFromStats);
                    
                    // Gastos do m√™s - mant√©m o c√°lculo local
                    const finList = finData?.list||[];
                    const currentMonth = today.slice(0,7);
                    const monthFin = finList.filter(f=>{
                        const dt = (f.created_at||'').slice(0,10);
                        return dt.startsWith(currentMonth);
                    });
                    const monthOutcome = monthFin.filter(f=>!(f.type==='income'||f.type==='entrada')).reduce((s,f)=>s+parseFloat(f.amount||0),0);
                    console.log('Total Sa√≠das M√™s:', monthOutcome);
                    
                    setWeekFinance({income:weekIncomeFromStats,outcome:weekOutcomeFromStats,monthOutcome});
                    
                    // Board - Foto do dia
                    const boardPhotos = Array.isArray(boardData)?boardData:[];
                    console.log('Board photos:', boardPhotos);
                    const todayPhoto = boardPhotos.find(p=>(p.photo_date||'').startsWith(today));
                    console.log('Today photo:', todayPhoto);
                    setBoardPhoto(todayPhoto||null);

                    // Routine
                    if(routineData && !routineData.error && routineData.log_date){
                        setRoutineMood(routineData.mood||'üòä');
                        setRoutineContent(routineData.content||'');
                    }

                    // Strava
                    const stravaList = (stravaData && stravaData.connected && Array.isArray(stravaData.list)) ? stravaData.list : [];
                    const todayPt = new Date().toLocaleDateString('pt-BR');
                    const trainedToday = stravaList.some(act=>{
                        const d = act.date || '';
                        return d.includes(today) || d.includes(todayPt);
                    });
                    const stravaSummary = stravaData?.summary || {};

                    setSummary({
                        today:{events:todayEvs.length,activities:actsRaw.length,doneActivities:doneToday,habitsDone},
                        week:{events:evs.filter(ev=>{const dt=ev.start_date?.replace(' ','T'); if(!dt) return false; const d=new Date(dt); const {start,end}=getWeekRange(); return d>=new Date(`${start}T00:00:00`) && d<=new Date(`${end}T23:59:59`);}).length,activities:0},
                        finance:finSummary,
                        routine:routineData && routineData.log_date ? {mood:routineData.mood||'üìù',content:routineData.content||''} : {mood:'üìù',content:'Sem anota√ß√£o'},
                        strava:{trainedToday,time:stravaSummary.total_time||'0h',activities:stravaSummary.total_activities||0}
                    });

                    setStatus('Online');
                } catch(err){
                    console.error(err);
                    setStatus('Erro');
                } finally { setLoading(false); }
            };

            const addActivity=async()=>{
                if(!actTitle) return;
                const res=await api('../modules/activities.php?api=save_activity',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({title:actTitle,date:today,period:actPeriod,source:'mobile'})});
                if(res&&!res.error){setActTitle('');loadAll();} else setStatus(res?.error||'Erro');
            };

            const toggleActivity=async(id)=>{
                await api('../modules/activities.php?api=toggle_activity',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id})});
                loadAll();
            };

            const toggleHabit=async(id)=>{
                await api('../modules/habits.php?api=toggle_habit',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id,date:today})});
                loadAll();
            };

            const addFinance=async()=>{
                if(!finAmount||!finDesc) return;
                await api('../modules/finance.php?api=save_finance',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({type:finType,amount:finAmount,description:finDesc,date:nowLocal().toISOString().slice(0,16)})});
                setFinAmount('');setFinDesc('');loadAll();
            };

            const uploadBoard=async()=>{
                if(!boardFile) return;
                const fd=new FormData(); fd.append('photo',boardFile); fd.append('photo_date',today);
                const res = await fetch('../modules/board.php?api=upload_photo',{method:'POST',body:fd,credentials:'same-origin'});
                const result = await res.json();
                console.log('Upload board result:', result);
                if(result.success) {
                    setBoardFile(null); setStatus('Foto enviada'); 
                    await loadAll();
                } else {
                    setStatus('Erro no upload: ' + (result.error || 'desconhecido'));
                }
            };

            const deleteBoard=async()=>{
                if(!boardPhoto || !boardPhoto.id) return;
                if(!confirm('Deletar a foto do dia?')) return;
                const result = await api('../modules/board.php?api=delete_photo',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id:boardPhoto.id})});
                console.log('Delete board result:', result);
                if(result.success) {
                    setStatus('Foto deletada');
                    await loadAll();
                } else {
                    setStatus('Erro ao deletar: ' + (result.error || 'desconhecido'));
                }
            };

            const saveRoutine=async()=>{
                await api('../modules/routine.php?api=save_routine',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({date:today,mood:routineMood,content:routineContent})});
                setStatus('Rotina salva');loadAll();
            };

            return (
                <div style={{display:'flex',flexDirection:'column',gap:12}}>
                    {/* VIS√ÉO R√ÅPIDA */}
                    <div className="card">
                        <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',gap:10,marginBottom:12}}>
                            <div style={{display:'flex',alignItems:'center',gap:8}}>
                                <h2 className="title" style={{fontSize:'16px',margin:0}}>üìä Vis√£o R√°pida</h2>
                                <span className="badge">Hoje</span>
                            </div>
                            <button className="pill" onClick={loadAll} disabled={loading}>{loading?'...':'üîÑ'}</button>
                        </div>
                        <div className="grid2">
                            <div className="item"><div className="label">Eventos hoje</div><div className="title" style={{fontSize:20}}>{summary.today.events}</div></div>
                            <div className="item"><div className="label">Atividades</div><div className="title" style={{fontSize:20}}>{summary.today.doneActivities}/{summary.today.activities}</div></div>
                            <div className="item"><div className="label">H√°bitos feitos</div><div className="title" style={{fontSize:20}}>{summary.today.habitsDone}</div></div>
                            <div className="item"><div className="label">Gastos Semana</div><div className="title" style={{fontSize:18,color:'#dc2626'}}>{fmtMoney(weekFinance.outcome||0)}</div></div>
                            <div className="item"><div className="label">Rotina</div><div className="title" style={{fontSize:18}}>{summary.routine.mood}</div></div>
                            <div className="item"><div className="label">Treinou?</div><div className="title" style={{fontSize:18}}>{summary.strava.trainedToday?'‚úÖ Sim':'‚ùå N√£o'}</div></div>
                        </div>
                    </div>
                    
                    {/* DIAS DA SEMANA */}
                    <div className="card">
                        <div className="label" style={{marginBottom:8,textAlign:'center'}}>Semana Atual</div>
                        <div style={{display:'flex',gap:8,overflowX:'auto',padding:'4px 0'}}>
                            {[...Array(7)].map((_,i)=>{
                                const d=new Date();
                                const dow=d.getDay()===0?6:d.getDay()-1;
                                d.setDate(d.getDate()-dow+i);
                                const ds=d.toISOString().slice(0,10);
                                const isToday=ds===today;
                                const dayNames=['Seg','Ter','Qua','Qui','Sex','S√°b','Dom'];
                                return (
                                    <div key={i} style={{minWidth:48,textAlign:'center',padding:'8px 6px',borderRadius:12,border:'1px solid var(--border)',background:isToday?'linear-gradient(135deg,rgba(139,155,255,0.26),rgba(93,211,255,0.2))':'var(--card)',color:isToday?'#f5f7ff':'var(--muted)'}}>
                                        <div style={{fontSize:11,marginBottom:4}}>{dayNames[i]}</div>
                                        <div style={{fontWeight:800,fontSize:16}}>{d.getDate()}</div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {/* EVENTOS DO DIA */}
                    <div className="card">
                        <h3 className="title" style={{fontSize:'15px',marginBottom:10}}>üìÖ Eventos de Hoje</h3>
                        {!todayEvents.length && <div className="label">Sem eventos hoje</div>}
                        {todayEvents.map(ev=>{
                            const dt=ev.start_date?.replace(' ','T');
                            const hour = dt? new Date(dt).toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'}) : '';
                            return (
                                <div key={ev.id||ev.google_event_id} className="item" style={{marginBottom:8}}>
                                    <div className="title" style={{display:'flex',alignItems:'center',gap:8}}>
                                        <span>{eventEmoji(ev.title)}</span><span>{ev.title||'Sem t√≠tulo'}</span>
                                    </div>
                                    <div className="meta"><span className="badge">{hour||'Hor√°rio'}</span></div>
                                </div>
                            );
                        })}
                    </div>

                    {/* ATIVIDADES DO DIA */}
                    <div className="card">
                        <h3 className="title" style={{fontSize:'15px',marginBottom:10}}>‚úÖ Atividades de Hoje</h3>
                        <div style={{display:'flex',gap:8,marginBottom:10}}>
                            <input className="input" placeholder="Nova atividade" value={actTitle} onChange={e=>setActTitle(e.target.value)} style={{flex:1}} />
                            <select className="input" value={actPeriod} onChange={e=>setActPeriod(e.target.value)} style={{width:100}}>
                                <option value="morning">Manh√£</option><option value="afternoon">Tarde</option><option value="night">Noite</option>
                            </select>
                            <button className="action" onClick={addActivity} style={{width:60}}>+</button>
                        </div>
                        {!todayActivities.length && <div className="label">Sem atividades hoje</div>}
                        {todayActivities.map(a=>(
                            <div key={a.id} className="item" style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:8}}>
                                <div style={{display:'flex',gap:10,alignItems:'center'}}>
                                    <span>{periodIcon(a.period)}</span>
                                    <div><div className="title">{a.title}</div><div className="meta"><span className="badge">{periodLabel(a.period)}</span></div></div>
                                </div>
                                <button onClick={()=>toggleActivity(a.id)} style={{border:'none',background:'transparent',fontSize:20,cursor:'pointer'}}>
                                    {Number(a.status)===1?'‚òëÔ∏è':'‚¨ú'}
                                </button>
                            </div>
                        ))}
                    </div>

                    {/* REGISTRO DE H√ÅBITOS */}
                    <div className="card">
                        <h3 className="title" style={{fontSize:'15px',marginBottom:10}}>üéØ Marcar H√°bitos</h3>
                        {!habits.length && <div className="label">Sem h√°bitos cadastrados</div>}
                        <div style={{display:'grid',gap:8}}>
                            {habits.map((h,idx)=>{
                                const parsed = h.checked_dates?JSON.parse(h.checked_dates):[];
                                const done = parsed.includes(today);
                                return (
                                    <div key={h.id} className="item" style={{display:'flex',justifyContent:'space-between',alignItems:'center',background:habitColors[idx%habitColors.length]}}>
                                        <div className="title" style={{display:'flex',alignItems:'center',gap:8}}><span>üî•</span><span>{h.name}</span></div>
                                        <button onClick={()=>toggleHabit(h.id)} style={{border:'none',background:done?'#5fe37c':'transparent',color:done?'#000':'#fff',padding:'6px 12px',borderRadius:999,cursor:'pointer',fontWeight:800}}>
                                            {done?'‚úì':'Marcar'}
                                        </button>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {/* FINAN√áAS */}
                    <div className="card">
                        <h3 className="title" style={{fontSize:'15px',marginBottom:10}}>üí∞ Registrar Gasto/Entrada</h3>
                        
                        {/* Resumo Mensal */}
                        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:8,marginBottom:12}}>
                            <div className="item" style={{textAlign:'center'}}>
                                <div className="label" style={{fontSize:11}}>Saldo Total</div>
                                <div className="title" style={{fontSize:14,color:'#8b9bff'}}>{fmtMoney(summary.finance.total_balance||0)}</div>
                            </div>
                            <div className="item" style={{textAlign:'center'}}>
                                <div className="label" style={{fontSize:11}}>Entradas M√™s</div>
                                <div className="title" style={{fontSize:14,color:'#16a34a'}}>{fmtMoney(summary.finance.income||0)}</div>
                            </div>
                            <div className="item" style={{textAlign:'center'}}>
                                <div className="label" style={{fontSize:11}}>Sa√≠das M√™s</div>
                                <div className="title" style={{fontSize:14,color:'#dc2626'}}>{fmtMoney(summary.finance.outcome||0)}</div>
                            </div>
                        </div>
                        
                        <div style={{display:'grid',gap:8,marginBottom:10}}>
                            <select className="input" value={finType} onChange={e=>setFinType(e.target.value)}>
                                <option value="expense">üí∏ Sa√≠da</option><option value="income">üíµ Entrada</option>
                            </select>
                            <input className="input" type="number" step="0.01" placeholder="Valor" value={finAmount} onChange={e=>setFinAmount(e.target.value)} />
                            <input className="input" placeholder="Descri√ß√£o" value={finDesc} onChange={e=>setFinDesc(e.target.value)} />
                            <button className="action" onClick={addFinance}>Adicionar</button>
                        </div>
                    </div>

                    {/* BOARD - IMAGEM DO DIA */}
                    <div className="card">
                        <h3 className="title" style={{fontSize:'15px',marginBottom:10}}>üì∏ Imagem do Dia</h3>
                        {boardPhoto && boardPhoto.image_path && (
                            <div style={{marginBottom:10}}>
                                <div style={{marginBottom:8,borderRadius:14,overflow:'hidden',border:'1px solid var(--border)'}}>
                                    <img src={boardPhoto.image_path} alt="Foto do dia" style={{width:'100%',display:'block'}} onError={(e)=>{console.error('Erro ao carregar imagem:', boardPhoto.image_path, e); e.target.style.display='none';}} />
                                </div>
                                <button className="action" onClick={deleteBoard} style={{background:'linear-gradient(135deg,#dc2626,#b91c1c)',marginBottom:8}}>üóëÔ∏è Deletar Foto</button>
                            </div>
                        )}
                        {!boardPhoto && <div className="label" style={{textAlign:'center',padding:20,color:'var(--muted)'}}>Nenhuma foto registrada hoje</div>}
                        <input className="input" type="file" accept="image/*" onChange={e=>setBoardFile(e.target.files[0])} style={{marginBottom:8}} />
                        <button className="action" onClick={uploadBoard}>Enviar Foto</button>
                    </div>

                    {/* ROTINA */}
                    <div className="card">
                        <h3 className="title" style={{fontSize:'15px',marginBottom:10}}>üìñ Rotina do Dia</h3>
                        <div className="item" style={{display:'flex',gap:8,justifyContent:'space-between',alignItems:'center',marginBottom:10}}>
                            <div className="label">Humor</div>
                            <div style={{display:'flex',gap:6}}>
                                {['ü§©','üòä','üòê','üòü','üò≠'].map(m=>(
                                    <button key={m} onClick={()=>setRoutineMood(m)} style={{border:'none',background:'transparent',fontSize:20,opacity:routineMood===m?1:0.3,cursor:'pointer'}}>{m}</button>
                                ))}
                            </div>
                        </div>
                        <textarea className="input" style={{height:100,marginBottom:8}} placeholder="Como foi seu dia?" value={routineContent} onChange={e=>setRoutineContent(e.target.value)}></textarea>
                        <button className="action" onClick={saveRoutine}>Salvar Rotina</button>
                    </div>

                    {/* MENSAGEM DO DIA */}
                    <div className="card" style={{textAlign:'center',padding:24}}>
                        <div style={{fontSize:32,marginBottom:12}}>‚ú®</div>
                        <div className="title" style={{fontSize:16,marginBottom:8}}>Mensagem do Dia</div>
                        <div className="label" style={{fontSize:14,lineHeight:1.6,textAlign:'justify'}}>{dailyMessage}</div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
