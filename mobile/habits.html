<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LifeOS Mobile - H치bitos</title>
  <link rel="manifest" href="../manifest.json">
  <link rel="stylesheet" href="style.css">
  <script defer src="common.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">LifeOS Mobile</div>
    <div id="status" class="status">Online</div>
  </header>

  <main class="shell">
    <nav class="nav">
      <a href="dashboard.html" data-page="dashboard">Dashboard</a>
      <a href="agenda.html" data-page="agenda">Agenda</a>
      <a href="activities.html" data-page="activities">Atividades</a>
      <a href="habits.html" data-page="habits" class="active">H치bitos</a>
    </nav>

    <section class="card">
      <div class="card-header">
        <h2>H치bitos</h2>
        <input type="month" id="habits-month" class="auto-month">
      </div>
      <div id="habits-list" class="list grid" style="margin-top:0.75rem"></div>
    </section>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      initNav('habits');
      fillDefaultInputs();
      bind();
      loadHabits();
    });

    function bind(){
      document.getElementById('habits-month').addEventListener('change', loadHabits);
    }

    async function loadHabits(){
      const ym = document.getElementById('habits-month').value || new Date().toISOString().slice(0,7);
      const list = document.getElementById('habits-list');
      list.innerHTML = '<div class="item">Carregando...</div>';
      const data = await api(`../modules/habits.php?api=get_habits&month=${ym}`);
      if (!data || data.error) { list.innerHTML = `<div class="item">Erro ao carregar${data?.error ? ': ' + data.error : ''}.</div>`; return; }
      if (!data.length) { list.innerHTML = '<div class="item">Sem h치bitos.</div>'; return; }
      list.innerHTML = data.map(h => {
        const checks = h.checked_dates ? JSON.parse(h.checked_dates).length : 0;
        return `<div class="item">
          <div class="title">${h.name}</div>
          <div class="meta">Check-ins: ${checks}</div>
        </div>`;
      }).join('');
    }
  </script>
</body>
</html>
